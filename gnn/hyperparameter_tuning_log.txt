
--- Generating data for window_size=90 ---
Total graphs: 399, Training graphs: 319, Testing graphs: 80

--- Tuning with window_size=90, learning_rate=0.001, epochs=1000 ---
Training on 319 graphs...
Epoch 10, Avg Loss: 0.6934, Avg Valid Labels per Graph: 12.00
Epoch 20, Avg Loss: 0.6930, Avg Valid Labels per Graph: 12.00
Epoch 30, Avg Loss: 0.6919, Avg Valid Labels per Graph: 12.00
Epoch 40, Avg Loss: 0.6892, Avg Valid Labels per Graph: 12.00
Epoch 50, Avg Loss: 0.6855, Avg Valid Labels per Graph: 12.00
Epoch 60, Avg Loss: 0.6805, Avg Valid Labels per Graph: 12.00
Epoch 70, Avg Loss: 0.6754, Avg Valid Labels per Graph: 12.00
Epoch 80, Avg Loss: 0.6697, Avg Valid Labels per Graph: 12.00
Epoch 90, Avg Loss: 0.6631, Avg Valid Labels per Graph: 12.00
Epoch 100, Avg Loss: 0.6564, Avg Valid Labels per Graph: 12.00
Epoch 110, Avg Loss: 0.6543, Avg Valid Labels per Graph: 12.00
Epoch 120, Avg Loss: 0.6476, Avg Valid Labels per Graph: 12.00
Epoch 130, Avg Loss: 0.6432, Avg Valid Labels per Graph: 12.00
Epoch 140, Avg Loss: 0.6362, Avg Valid Labels per Graph: 12.00
Epoch 150, Avg Loss: 0.6298, Avg Valid Labels per Graph: 12.00
Epoch 160, Avg Loss: 0.6247, Avg Valid Labels per Graph: 12.00
Epoch 170, Avg Loss: 0.6204, Avg Valid Labels per Graph: 12.00
Epoch 180, Avg Loss: 0.6155, Avg Valid Labels per Graph: 12.00
Epoch 190, Avg Loss: 0.6079, Avg Valid Labels per Graph: 12.00
Epoch 200, Avg Loss: 0.6018, Avg Valid Labels per Graph: 12.00
Epoch 210, Avg Loss: 0.6011, Avg Valid Labels per Graph: 12.00
Epoch 220, Avg Loss: 0.5934, Avg Valid Labels per Graph: 12.00
Epoch 230, Avg Loss: 0.5881, Avg Valid Labels per Graph: 12.00
Epoch 240, Avg Loss: 0.5813, Avg Valid Labels per Graph: 12.00
Epoch 250, Avg Loss: 0.5767, Avg Valid Labels per Graph: 12.00
Epoch 260, Avg Loss: 0.5666, Avg Valid Labels per Graph: 12.00
Epoch 270, Avg Loss: 0.5649, Avg Valid Labels per Graph: 12.00
Epoch 280, Avg Loss: 0.5563, Avg Valid Labels per Graph: 12.00
Epoch 290, Avg Loss: 0.5541, Avg Valid Labels per Graph: 12.00
Epoch 300, Avg Loss: 0.5475, Avg Valid Labels per Graph: 12.00
Epoch 310, Avg Loss: 0.5468, Avg Valid Labels per Graph: 12.00
Epoch 320, Avg Loss: 0.5381, Avg Valid Labels per Graph: 12.00
Epoch 330, Avg Loss: 0.5412, Avg Valid Labels per Graph: 12.00
Epoch 340, Avg Loss: 0.5323, Avg Valid Labels per Graph: 12.00
Epoch 350, Avg Loss: 0.5211, Avg Valid Labels per Graph: 12.00
Epoch 360, Avg Loss: 0.5150, Avg Valid Labels per Graph: 12.00
Epoch 370, Avg Loss: 0.5118, Avg Valid Labels per Graph: 12.00
Epoch 380, Avg Loss: 0.5421, Avg Valid Labels per Graph: 12.00
Epoch 390, Avg Loss: 0.5009, Avg Valid Labels per Graph: 12.00
Epoch 400, Avg Loss: 0.4940, Avg Valid Labels per Graph: 12.00
Epoch 410, Avg Loss: 0.4964, Avg Valid Labels per Graph: 12.00
Epoch 420, Avg Loss: 0.4923, Avg Valid Labels per Graph: 12.00
Epoch 430, Avg Loss: 0.4924, Avg Valid Labels per Graph: 12.00
Epoch 440, Avg Loss: 0.4801, Avg Valid Labels per Graph: 12.00
Epoch 450, Avg Loss: 0.4863, Avg Valid Labels per Graph: 12.00
Epoch 460, Avg Loss: 0.4603, Avg Valid Labels per Graph: 12.00
Epoch 470, Avg Loss: 0.4783, Avg Valid Labels per Graph: 12.00
Epoch 480, Avg Loss: 0.4562, Avg Valid Labels per Graph: 12.00
Epoch 490, Avg Loss: 0.4572, Avg Valid Labels per Graph: 12.00
Epoch 500, Avg Loss: 0.4621, Avg Valid Labels per Graph: 12.00
Epoch 510, Avg Loss: 0.4642, Avg Valid Labels per Graph: 12.00
Epoch 520, Avg Loss: 0.4386, Avg Valid Labels per Graph: 12.00
Epoch 530, Avg Loss: 0.4383, Avg Valid Labels per Graph: 12.00
Epoch 540, Avg Loss: 0.4234, Avg Valid Labels per Graph: 12.00
Epoch 550, Avg Loss: 0.4232, Avg Valid Labels per Graph: 12.00
Epoch 560, Avg Loss: 0.4129, Avg Valid Labels per Graph: 12.00
Epoch 570, Avg Loss: 0.4175, Avg Valid Labels per Graph: 12.00
Epoch 580, Avg Loss: 0.4106, Avg Valid Labels per Graph: 12.00
Epoch 590, Avg Loss: 0.4071, Avg Valid Labels per Graph: 12.00
Epoch 600, Avg Loss: 0.4019, Avg Valid Labels per Graph: 12.00
Epoch 610, Avg Loss: 0.3893, Avg Valid Labels per Graph: 12.00
Epoch 620, Avg Loss: 0.3862, Avg Valid Labels per Graph: 12.00
Epoch 630, Avg Loss: 0.4008, Avg Valid Labels per Graph: 12.00
Epoch 640, Avg Loss: 0.3907, Avg Valid Labels per Graph: 12.00
Epoch 650, Avg Loss: 0.3816, Avg Valid Labels per Graph: 12.00
Epoch 660, Avg Loss: 0.3779, Avg Valid Labels per Graph: 12.00
Epoch 670, Avg Loss: 0.3804, Avg Valid Labels per Graph: 12.00
Epoch 680, Avg Loss: 0.3787, Avg Valid Labels per Graph: 12.00
Epoch 690, Avg Loss: 0.3699, Avg Valid Labels per Graph: 12.00
Epoch 700, Avg Loss: 0.4305, Avg Valid Labels per Graph: 12.00
Epoch 710, Avg Loss: 0.3649, Avg Valid Labels per Graph: 12.00
Epoch 720, Avg Loss: 0.3628, Avg Valid Labels per Graph: 12.00
Epoch 730, Avg Loss: 0.4012, Avg Valid Labels per Graph: 12.00
Epoch 740, Avg Loss: 0.3585, Avg Valid Labels per Graph: 12.00
Epoch 750, Avg Loss: 0.3520, Avg Valid Labels per Graph: 12.00
Epoch 760, Avg Loss: 0.3462, Avg Valid Labels per Graph: 12.00
Epoch 770, Avg Loss: 0.3407, Avg Valid Labels per Graph: 12.00
Epoch 780, Avg Loss: 0.3302, Avg Valid Labels per Graph: 12.00
Epoch 790, Avg Loss: 0.3312, Avg Valid Labels per Graph: 12.00
Epoch 800, Avg Loss: 0.3498, Avg Valid Labels per Graph: 12.00
Epoch 810, Avg Loss: 0.3188, Avg Valid Labels per Graph: 12.00
Epoch 820, Avg Loss: 0.4108, Avg Valid Labels per Graph: 12.00
Epoch 830, Avg Loss: 0.3357, Avg Valid Labels per Graph: 12.00
Epoch 840, Avg Loss: 0.3186, Avg Valid Labels per Graph: 12.00
Epoch 850, Avg Loss: 0.3146, Avg Valid Labels per Graph: 12.00
Epoch 860, Avg Loss: 0.3895, Avg Valid Labels per Graph: 12.00
Epoch 870, Avg Loss: 0.2996, Avg Valid Labels per Graph: 12.00
Epoch 880, Avg Loss: 0.4017, Avg Valid Labels per Graph: 12.00
Epoch 890, Avg Loss: 0.3566, Avg Valid Labels per Graph: 12.00
Epoch 900, Avg Loss: 0.3412, Avg Valid Labels per Graph: 12.00
Epoch 910, Avg Loss: 0.3034, Avg Valid Labels per Graph: 12.00
Epoch 920, Avg Loss: 0.3229, Avg Valid Labels per Graph: 12.00
Epoch 930, Avg Loss: 0.3104, Avg Valid Labels per Graph: 12.00
Epoch 940, Avg Loss: 0.2769, Avg Valid Labels per Graph: 12.00
Epoch 950, Avg Loss: 0.4373, Avg Valid Labels per Graph: 12.00
Epoch 960, Avg Loss: 0.2815, Avg Valid Labels per Graph: 12.00
Epoch 970, Avg Loss: 0.3165, Avg Valid Labels per Graph: 12.00
Epoch 980, Avg Loss: 0.2659, Avg Valid Labels per Graph: 12.00
Epoch 990, Avg Loss: 0.2956, Avg Valid Labels per Graph: 12.00
Epoch 1000, Avg Loss: 0.3716, Avg Valid Labels per Graph: 12.00
Saved loss plot to loss_ws90_lr0.001.png

--- Evaluating on Training Data (during tuning) ---

Evaluating Model Performance:
Evaluation based on 3828 data points from 319 graphs (avg 12.00 valid labels/graph).
  Prediction distribution (raw outputs): Min: 0.0000, Max: 1.0000, Mean: 0.5305, Std: 0.3807
  Number of predictions between 0.4 and 0.6: 407 (out of 3828)

Overall Accuracy: 0.7900 (3024/3828)
Class Breakdown (Overall Sector):
  Correct Down Predictions: 1434 (out of 1909 actual down instances)
  Correct Up Predictions: 1590 (out of 1919 actual up instances)
Training Accuracy (for current params): 0.7900

--- Evaluating on Test Data (during tuning) ---

Evaluating Model Performance:
Evaluation based on 960 data points from 80 graphs (avg 12.00 valid labels/graph).
  Prediction distribution (raw outputs): Min: 0.0000, Max: 1.0000, Mean: 0.4299, Std: 0.4175
  Number of predictions between 0.4 and 0.6: 78 (out of 960)

Overall Accuracy: 0.4927 (473/960)
Class Breakdown (Overall Sector):
  Correct Down Predictions: 261 (out of 465 actual down instances)
  Correct Up Predictions: 212 (out of 495 actual up instances)
Test Accuracy (for current params): 0.4927
Result: WS=90, LR=0.001, Final Avg Loss=0.3716, Train Acc=0.7900, Test Acc=0.4927
*** New best test accuracy: 0.4927 with params: {'window_size': 90, 'learning_rate': 0.001, 'train_accuracy_at_best_test': 0.7899686520376176} ***

--- Hyperparameter Tuning Summary ---
WS=90, LR=0.001, Final Loss=0.3716, Train Acc=0.7900, Test Acc=0.4927

Best Test Accuracy: 0.4927
Best Parameters: {best_params}

--- Running with Best Parameters (or default if tuning was skipped/failed) ---
Using final parameters: window_size=90, learning_rate=0.001, epochs=100
Final Run - Total graphs: 399, Training graphs: 319, Testing graphs: 80

--- Training final model ---
Training final model on 319 graphs...
Epoch 10, Avg Loss: 0.6935, Avg Valid Labels per Graph: 12.00
Epoch 20, Avg Loss: 0.6927, Avg Valid Labels per Graph: 12.00
Epoch 30, Avg Loss: 0.6907, Avg Valid Labels per Graph: 12.00
Epoch 40, Avg Loss: 0.6875, Avg Valid Labels per Graph: 12.00
Epoch 50, Avg Loss: 0.6849, Avg Valid Labels per Graph: 12.00
Epoch 60, Avg Loss: 0.6821, Avg Valid Labels per Graph: 12.00
Epoch 70, Avg Loss: 0.6796, Avg Valid Labels per Graph: 12.00
Epoch 80, Avg Loss: 0.6766, Avg Valid Labels per Graph: 12.00
Epoch 90, Avg Loss: 0.6732, Avg Valid Labels per Graph: 12.00
Epoch 100, Avg Loss: 0.6687, Avg Valid Labels per Graph: 12.00
Saved loss plot to loss_wsfinal_ws90_lrfinal_lr0.001.png

--- Evaluating final model on Training Data ---

Evaluating Model Performance:
Evaluation based on 3828 data points from 319 graphs (avg 12.00 valid labels/graph).
  Prediction distribution (raw outputs): Min: 0.0649, Max: 0.9551, Mean: 0.5189, Std: 0.0972
  Number of predictions between 0.4 and 0.6: 2958 (out of 3828)

Overall Accuracy: 0.5899 (2258/3828)
Class Breakdown (Overall Sector):
  Correct Down Predictions: 933 (out of 1909 actual down instances)
  Correct Up Predictions: 1325 (out of 1919 actual up instances)
Final Model Training Accuracy: 0.5899

--- Evaluating final model on Test Data ---

Evaluating Model Performance:
Evaluation based on 960 data points from 80 graphs (avg 12.00 valid labels/graph).
  Prediction distribution (raw outputs): Min: 0.0157, Max: 0.6375, Mean: 0.3504, Std: 0.1561
  Number of predictions between 0.4 and 0.6: 387 (out of 960)

Overall Accuracy: 0.5177 (497/960)
Class Breakdown (Overall Sector):
  Correct Down Predictions: 376 (out of 465 actual down instances)
  Correct Up Predictions: 121 (out of 495 actual up instances)
Final Model Test Accuracy: 0.5177
\nHyperparameter tuning script finished.
